<script src="bower_components/page/page.js"></script>
<script>
    window.addEventListener('WebComponentsReady', function() {

        // Middleware
        function scrollToTop(ctx, next) {
            app.scrollPageToTop();
            next();
        }
        // Routes
        page('*', function(ctx, next) {
            if (app.user.isLogged && ctx.path != '/login') {
                next();
            } else if (app.user.isLogged && ctx.path == '/login') {
                app.$.toast.text = 'User successful authorized. Redirected you to Home page';
                app.$.toast.show();
                page.redirect(app.baseUrl);
            } else if (!app.user.isLogged && ctx.path == '/login') {
                next();
            }else {
                app.$.toast.text = 'User unauthorized. Redirected you to Login page';
                app.$.toast.show();
                page.redirect('/login');
            }
        });

        page('/', scrollToTop, function() {
            app.route = 'inbox';
        });
        page(app.baseUrl, scrollToTop, function() {
            app.route = 'inbox';
        });
        page('/users', scrollToTop, function() {
            app.route = 'users';
        });
        page('/users/:name', scrollToTop, function(data) {
            app.route = 'user-info';
            app.params = data.params;
        });

        page('/login', scrollToTop, function() {
            app.route = 'login';
        });

        page('*', function() {
            app.$.toast.text = 'Can\'t find: ' + window.location.href  + '. Redirected you to Home Page';
            app.$.toast.show();
            page.redirect(app.baseUrl);
        });
        // add #! before urls
        page({
            hashbang: true
        });
    });
</script>